{"version":3,"file":"twofactor_backupcodes-settings.mjs","sources":["../apps/twofactor_backupcodes/src/service/PrintService.js","../apps/twofactor_backupcodes/src/views/PersonalSettings.vue","../apps/twofactor_backupcodes/src/service/BackupCodesService.js","../apps/twofactor_backupcodes/src/store.js","../apps/twofactor_backupcodes/src/settings.js"],"sourcesContent":["/**\n * @copyright Copyright (c) 2016 John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @author Christoph Wurst <christoph@winzerhof-wurst.at>\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\n/**\n * @param {any} data -\n */\nexport function print(data) {\n\tconst name = OC.theme.name || 'Nextcloud'\n\tconst newTab = window.open('', t('twofactor_backupcodes', '{name} backup codes', { name }))\n\tnewTab.document.write('<h1>' + t('twofactor_backupcodes', '{name} backup codes', { name }) + '</h1>')\n\tnewTab.document.write('<pre>' + data + '</pre>')\n\tnewTab.print()\n\tnewTab.close()\n}\n","<template>\n\t<div>\n\t\t<button v-if=\"!enabled\"\n\t\t\tid=\"generate-backup-codes\"\n\t\t\t:disabled=\"generatingCodes\"\n\t\t\t@click=\"generateBackupCodes\">\n\t\t\t{{ t('twofactor_backupcodes', 'Generate backup codes') }}\n\t\t\t<span :class=\"{'icon-loading-small': generatingCodes}\" />\n\t\t</button>\n\t\t<template v-else>\n\t\t\t<p>\n\t\t\t\t<template v-if=\"!haveCodes\">\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'Backup codes have been generated. {used} of {total} codes have been used.', {used, total}) }}\n\t\t\t\t</template>\n\t\t\t\t<template v-else>\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'These are your backup codes. Please save and/or print them as you will not be able to read the codes again later') }}\n\t\t\t\t\t<ul>\n\t\t\t\t\t\t<li v-for=\"code in codes\" :key=\"code\" class=\"backup-code\">\n\t\t\t\t\t\t\t{{ code }}\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<a :href=\"downloadUrl\"\n\t\t\t\t\t\tclass=\"button primary\"\n\t\t\t\t\t\t:download=\"downloadFilename\">{{ t('twofactor_backupcodes', 'Save backup codes') }}</a>\n\t\t\t\t\t<button class=\"button\"\n\t\t\t\t\t\t@click=\"printCodes\">\n\t\t\t\t\t\t{{ t('twofactor_backupcodes', 'Print backup codes') }}\n\t\t\t\t\t</button>\n\t\t\t\t</template>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<button id=\"generate-backup-codes\"\n\t\t\t\t\t@click=\"generateBackupCodes\">\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'Regenerate backup codes') }}\n\t\t\t\t</button>\n\t\t\t</p>\n\t\t\t<p>\n\t\t\t\t<em>\n\t\t\t\t\t{{ t('twofactor_backupcodes', 'If you regenerate backup codes, you automatically invalidate old codes.') }}\n\t\t\t\t</em>\n\t\t\t</p>\n\t\t</template>\n\t</div>\n</template>\n\n<script>\nimport { confirmPassword } from '@nextcloud/password-confirmation'\nimport '@nextcloud/password-confirmation/dist/style.css'\nimport { print } from '../service/PrintService.js'\n\nexport default {\n\tname: 'PersonalSettings',\n\tdata() {\n\t\treturn {\n\t\t\tgeneratingCodes: false,\n\t\t}\n\t},\n\tcomputed: {\n\t\tdownloadUrl() {\n\t\t\tif (!this.codes) {\n\t\t\t\treturn ''\n\t\t\t}\n\t\t\treturn 'data:text/plain,' + encodeURIComponent(this.codes.reduce((prev, code) => {\n\t\t\t\treturn prev + code + '\\r\\n'\n\t\t\t}, ''))\n\t\t},\n\t\tdownloadFilename() {\n\t\t\tconst name = OC.theme.name || 'Nextcloud'\n\t\t\treturn name + '-backup-codes.txt'\n\t\t},\n\t\tenabled() {\n\t\t\treturn this.$store.state.enabled\n\t\t},\n\t\ttotal() {\n\t\t\treturn this.$store.state.total\n\t\t},\n\t\tused() {\n\t\t\treturn this.$store.state.used\n\t\t},\n\t\tcodes() {\n\t\t\treturn this.$store.state.codes\n\t\t},\n\t\tname() {\n\t\t\treturn OC.theme.name || 'Nextcloud'\n\t\t},\n\t\thaveCodes() {\n\t\t\treturn this.codes && this.codes.length > 0\n\t\t},\n\t},\n\tmethods: {\n\t\tgenerateBackupCodes() {\n\t\t\tconfirmPassword().then(() => {\n\t\t\t\t// Hide old codes\n\t\t\t\tthis.generatingCodes = true\n\n\t\t\t\tthis.$store.dispatch('generate').then(data => {\n\t\t\t\t\tthis.generatingCodes = false\n\t\t\t\t}).catch(err => {\n\t\t\t\t\tOC.Notification.showTemporary(t('twofactor_backupcodes', 'An error occurred while generating your backup codes'))\n\t\t\t\t\tthis.generatingCodes = false\n\t\t\t\t\tthrow err\n\t\t\t\t})\n\t\t\t}).catch(console.error.bind(this))\n\t\t},\n\n\t\tgetPrintData(codes) {\n\t\t\tif (!codes) {\n\t\t\t\treturn ''\n\t\t\t}\n\t\t\treturn codes.reduce((prev, code) => {\n\t\t\t\treturn prev + code + '<br>'\n\t\t\t}, '')\n\t\t},\n\n\t\tprintCodes() {\n\t\t\tprint(this.getPrintData(this.codes))\n\t\t},\n\t},\n}\n</script>\n\n<style scoped>\n\t.backup-code {\n\t\tfont-family: monospace;\n\t\tletter-spacing: 0.02em;\n\t\tfont-size: 1.2em;\n\t}\n\t.button {\n\t\tdisplay: inline-block;\n\t}\n</style>\n","/**\n * @copyright Copyright (c) 2016 Christoph Wurst <christoph@winzerhof-wurst.at>\n *\n * @author Christoph Wurst <christoph@winzerhof-wurst.at>\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport Axios from '@nextcloud/axios'\nimport { generateUrl } from '@nextcloud/router'\n\n/**\n *\n */\nexport function generateCodes() {\n\tconst url = generateUrl('/apps/twofactor_backupcodes/settings/create')\n\n\treturn Axios.post(url, {}).then(resp => resp.data)\n}\n","/**\n * @copyright 2019 Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport Vue from 'vue'\nimport Vuex, { Store } from 'vuex'\nimport { generateCodes } from './service/BackupCodesService.js'\n\nVue.use(Vuex)\n\nconst state = {\n\tenabled: false,\n\ttotal: 0,\n\tused: 0,\n\tcodes: [],\n}\n\nconst mutations = {\n\tsetEnabled(state, enabled) {\n\t\tVue.set(state, 'enabled', enabled)\n\t},\n\tsetTotal(state, total) {\n\t\tVue.set(state, 'total', total)\n\t},\n\tsetUsed(state, used) {\n\t\tVue.set(state, 'used', used)\n\t},\n\tsetCodes(state, codes) {\n\t\tVue.set(state, 'codes', codes)\n\t},\n}\n\nconst actions = {\n\tgenerate({ commit }) {\n\t\tcommit('setEnabled', false)\n\n\t\treturn generateCodes().then(({ codes, state }) => {\n\t\t\tcommit('setEnabled', state.enabled)\n\t\t\tcommit('setTotal', state.total)\n\t\t\tcommit('setUsed', state.used)\n\t\t\tcommit('setCodes', codes)\n\t\t\treturn true\n\t\t})\n\t},\n}\n\nexport default new Store({\n\tstrict: process.env.NODE_ENV !== 'production',\n\tstate,\n\tmutations,\n\tactions,\n})\n","/**\n * @copyright Copyright (c) 2016 Christoph Wurst <christoph@winzerhof-wurst.at>\n *\n * @author Christoph Wurst <christoph@winzerhof-wurst.at>\n * @author John Molakvoæ <skjnldsv@protonmail.com>\n * @author Roeland Jago Douma <roeland@famdouma.nl>\n *\n * @license AGPL-3.0-or-later\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\n\nimport { loadState } from '@nextcloud/initial-state'\nimport Vue from 'vue'\n\nimport PersonalSettings from './views/PersonalSettings.vue'\nimport store from './store.js'\n\nVue.prototype.t = t\n\nconst initialState = loadState('twofactor_backupcodes', 'state')\nstore.replaceState(initialState)\n\nconst View = Vue.extend(PersonalSettings)\nnew View({\n\tstore,\n}).$mount('#twofactor-backupcodes-settings')\n"],"names":["print","data","name","newTab","_sfc_main","prev","code","confirmPassword","err","codes","generateCodes","url","generateUrl","Axios","resp","Vue","Vuex","state","mutations","enabled","total","used","actions","commit","store","Store","initialState","loadState","View","PersonalSettings"],"mappings":"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"}