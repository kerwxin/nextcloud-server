/*! third party licenses: dist/vendor.LICENSE.txt */
import"./index-Ca0QcE7e.mjs";import{v as u}from"./toast-7xJhDYMn-BrG8uCqw.mjs";import{bE as a,F as n,aj as c,T as o,ad as d,am as p,a4 as m}from"../core-common.mjs";import{g as h}from"./statusOptionsService-kAFFwt4A.mjs";import{d as _,O as g}from"../user_status-menu.mjs";import{m as r}from"./index-j_UZebeA.mjs";import{n as i}from"./icons-BxSPavMS.mjs";import{m as S,a as f}from"./vuex.esm-Bkiv_nyi.mjs";import"./preload-helper-3Yr03P9X.mjs";import"./index-Cf1NFlIs.mjs";import"./moment-B-oAqI-A.mjs";import"./moment-B1DRcIE-.mjs";const l=t=>{if(t===null)return a("user_status","Don't clear");if(t.type==="end-of")switch(t.time){case"day":return a("user_status","Today");case"week":return a("user_status","This week");default:return null}if(t.type==="period")return r.duration(t.time*1e3).humanize();if(t.type==="_time"){const e=r(_()),s=r(t.time,"X");return r.duration(e.diff(s)).humanize()}return null},v={name:"PredefinedStatus",filters:{clearAtFilter:l},props:{messageId:{type:String,required:!0},icon:{type:String,required:!0},message:{type:String,required:!0},clearAt:{type:Object,required:!1,default:null},selected:{type:Boolean,required:!1,default:!1}},computed:{id(){return"user-status-predefined-status-".concat(this.messageId)}},methods:{select(){this.$emit("select")}}};var y=function(){var t=this,e=t._self._c;return e("li",{staticClass:"predefined-status"},[e("input",{staticClass:"hidden-visually predefined-status__input",attrs:{id:t.id,type:"radio",name:"predefined-status"},domProps:{checked:t.selected},on:{change:t.select}}),e("label",{staticClass:"predefined-status__label",attrs:{for:t.id}},[e("span",{staticClass:"predefined-status__label--icon",attrs:{"aria-hidden":"true"}},[t._v(" "+t._s(t.icon)+" ")]),e("span",{staticClass:"predefined-status__label--message"},[t._v(" "+t._s(t.message)+" ")]),e("span",{staticClass:"predefined-status__label--clear-at"},[t._v(" "+t._s(t._f("clearAtFilter")(t.clearAt))+" ")])])])},b=[],C=i(v,y,b,!1,null,"d4396c63",null,null);const k=C.exports,$={name:"PredefinedStatusesList",components:{PredefinedStatus:k},data(){return{lastSelected:null}},computed:{...S({predefinedStatuses:t=>t.predefinedStatuses.predefinedStatuses,messageId:t=>t.userStatus.messageId}),...f(["statusesHaveLoaded"])},watch:{messageId:{immediate:!0,handler(){this.lastSelected=this.messageId}}},created(){this.$store.dispatch("loadAllPredefinedStatuses")},methods:{selectStatus(t){this.lastSelected=t.id,this.$emit("select-status",t)}}};var A=function(){var t=this,e=t._self._c;return t.statusesHaveLoaded?e("ul",{staticClass:"predefined-statuses-list",attrs:{"aria-label":t.t("user_status","Predefined statuses")}},t._l(t.predefinedStatuses,function(s){return e("PredefinedStatus",{key:s.id,attrs:{"message-id":s.id,icon:s.icon,message:s.message,"clear-at":s.clearAt,selected:t.lastSelected===s.id},on:{select:function(tt){return t.selectStatus(s)}}})}),1):e("div",{staticClass:"predefined-statuses-list"},[e("div",{staticClass:"icon icon-loading-small"})])},I=[],M=i($,A,I,!1,null,"4eb68e36",null,null);const B=M.exports,x={name:"PreviousStatus",components:{NcButton:n},props:{icon:{type:[String,null],required:!0},message:{type:String,required:!0}},methods:{select(){this.$emit("select")}}};var P=function(){var t=this,e=t._self._c;return e("div",{staticClass:"predefined-status backup-status",attrs:{tabindex:"0"},on:{keyup:[function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.select.apply(null,arguments)},function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"space",32,s.key,[" ","Spacebar"])?null:t.select.apply(null,arguments)}],click:t.select}},[e("span",{staticClass:"predefined-status__icon"},[t._v(" "+t._s(t.icon)+" ")]),e("span",{staticClass:"predefined-status__message"},[t._v(" "+t._s(t.message)+" ")]),e("span",{staticClass:"predefined-status__clear-at"},[t._v(" "+t._s(t.$t("user_status","Previously set"))+" ")]),e("div",{staticClass:"backup-status__reset-button"},[e("NcButton",{on:{click:t.select}},[t._v(" "+t._s(t.$t("user_status","Reset status"))+" ")])],1)])},N=[],w=i(x,P,N,!1,null,"5acfbba7",null,null);const F=w.exports,T={name:"CustomMessageInput",components:{NcTextField:c,NcButton:n,NcEmojiPicker:o},props:{icon:{type:String,default:"ðŸ˜€"},message:{type:String,required:!0,default:()=>""},disabled:{type:Boolean,default:!1}},emits:["change","select-icon"],computed:{visibleIcon(){return this.icon||"ðŸ˜€"}},methods:{focus(){this.$refs.input.focus()},onChange(t){this.$emit("change",t.target.value)},setIcon(t){this.$emit("select-icon",t)}}};var q=function(){var t=this,e=t._self._c;return e("div",{staticClass:"custom-input",attrs:{role:"group"}},[e("NcEmojiPicker",{attrs:{container:".custom-input"},on:{select:t.setIcon}},[e("NcButton",{attrs:{type:"tertiary","aria-label":t.t("user_status","Emoji for your status message")},scopedSlots:t._u([{key:"icon",fn:function(){return[t._v(" "+t._s(t.visibleIcon)+" ")]},proxy:!0}])})],1),e("div",{staticClass:"custom-input__container"},[e("NcTextField",{ref:"input",attrs:{maxlength:"80",disabled:t.disabled,placeholder:t.t("user_status","What is your status?"),value:t.message,type:"text",label:t.t("user_status","What is your status?")},on:{input:t.onChange}})],1)],1)},O=[],R=i(T,q,O,!1,null,"e058f05b",null,null);const j=R.exports,E=()=>[{label:a("user_status","Don't clear"),clearAt:null},{label:a("user_status","30 minutes"),clearAt:{type:"period",time:1800}},{label:a("user_status","1 hour"),clearAt:{type:"period",time:3600}},{label:a("user_status","4 hours"),clearAt:{type:"period",time:14400}},{label:a("user_status","Today"),clearAt:{type:"end-of",time:"day"}},{label:a("user_status","This week"),clearAt:{type:"end-of",time:"week"}}],L={name:"ClearAtSelect",components:{NcSelect:d},props:{clearAt:{type:Object,default:null}},data(){return{options:E()}},computed:{option(){return{clearAt:this.clearAt,label:l(this.clearAt)}}},methods:{select(t){t&&this.$emit("select-clear-at",t.clearAt)}}};var z=function(){var t=this,e=t._self._c;return e("div",{staticClass:"clear-at-select"},[e("label",{staticClass:"clear-at-select__label",attrs:{for:"clearStatus"}},[t._v(" "+t._s(t.$t("user_status","Clear status after"))+" ")]),e("NcSelect",{staticClass:"clear-at-select__select",attrs:{"input-id":"clearStatus",options:t.options,value:t.option,clearable:!1,placement:"top"},on:{"option:selected":t.select}})],1)},D=[],H=i(L,z,D,!1,null,"7d2977c5",null,null);const U=H.exports,W={name:"OnlineStatusSelect",components:{NcUserStatusIcon:p},props:{checked:{type:Boolean,default:!1},type:{type:String,required:!0},label:{type:String,required:!0},subline:{type:String,default:null}},computed:{id(){return"user-status-online-status-".concat(this.type)}},methods:{onChange(){this.$emit("select",this.type)}}};var X=function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-status-online-select"},[e("input",{staticClass:"hidden-visually user-status-online-select__input",attrs:{id:t.id,type:"radio",name:"user-status-online"},domProps:{checked:t.checked},on:{change:t.onChange}}),e("label",{staticClass:"user-status-online-select__label",attrs:{for:t.id}},[t._v(" "+t._s(t.label)+" "),e("NcUserStatusIcon",{attrs:{status:t.type,"aria-hidden":"true"}}),e("em",{staticClass:"user-status-online-select__subline"},[t._v(t._s(t.subline))])],1)])},Y=[],G=i(W,X,Y,!1,null,"ef965cc2",null,null);const J=G.exports,K={name:"SetStatusModal",components:{ClearAtSelect:U,CustomMessageInput:j,NcModal:m,OnlineStatusSelect:J,PredefinedStatusesList:B,PreviousStatus:F,NcButton:n},mixins:[g],props:{inline:{type:Boolean,default:!1}},data(){return{clearAt:null,editedMessage:"",isCustomStatus:!0,isSavingStatus:!1,statuses:h()}},computed:{messageId(){return this.$store.state.userStatus.messageId},icon(){return this.$store.state.userStatus.icon},message(){return this.$store.state.userStatus.message||""},hasBackupStatus(){return this.messageId&&(this.backupIcon||this.backupMessage)},backupIcon(){return this.$store.state.userBackupStatus.icon||""},backupMessage(){return this.$store.state.userBackupStatus.message||""},resetButtonText(){return this.backupIcon&&this.backupMessage?this.$t("user_status",'Reset status to "{icon} {message}"',{icon:this.backupIcon,message:this.backupMessage}):this.backupMessage?this.$t("user_status",'Reset status to "{message}"',{message:this.backupMessage}):this.backupIcon?this.$t("user_status",'Reset status to "{icon}"',{icon:this.backupIcon}):this.$t("user_status","Reset status")},setReturnFocus(){var t;if(!this.inline)return(t=document.querySelector('[aria-controls="header-menu-user-menu"]'))!=null?t:void 0}},watch:{message:{immediate:!0,handler(t){this.editedMessage=t}}},mounted(){this.$store.dispatch("fetchBackupFromServer"),this.$store.state.userStatus.clearAt!==null&&(this.clearAt={type:"_time",time:this.$store.state.userStatus.clearAt})},methods:{closeModal(){this.$emit("close")},setIcon(t){this.isCustomStatus=!0,this.$store.dispatch("setCustomMessage",{message:this.message,icon:t,clearAt:this.clearAt}),this.$nextTick(()=>{this.$refs.customMessageInput.focus()})},setMessage(t){this.isCustomStatus=!0,this.editedMessage=t},setClearAt(t){this.clearAt=t},selectPredefinedMessage(t){this.isCustomStatus=!1,this.clearAt=t.clearAt,this.$store.dispatch("setPredefinedMessage",{messageId:t.id,clearAt:t.clearAt})},async saveStatus(){if(!this.isSavingStatus){try{this.isSavingStatus=!0,this.isCustomStatus&&await this.$store.dispatch("setCustomMessage",{message:this.editedMessage,icon:this.icon,clearAt:this.clearAt})}catch(t){u(this.$t("user_status","There was an error saving the status")),console.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1,this.closeModal()}},async clearStatus(){try{this.isSavingStatus=!0,await this.$store.dispatch("clearMessage")}catch(t){u(this.$t("user_status","There was an error clearing the status")),console.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1,this.closeModal()},async revertBackupFromServer(){try{this.isSavingStatus=!0,await this.$store.dispatch("revertBackupFromServer",{messageId:this.messageId})}catch(t){u(this.$t("user_status","There was an error reverting the status")),console.debug(t),this.isSavingStatus=!1;return}this.isSavingStatus=!1}}};var Q=function(){var t=this,e=t._self._c;return e("NcModal",{attrs:{size:"normal",name:t.$t("user_status","Set status"),"set-return-focus":t.setReturnFocus},on:{close:t.closeModal}},[e("div",{staticClass:"set-status-modal"},[e("div",{staticClass:"set-status-modal__header"},[e("h2",[t._v(t._s(t.$t("user_status","Online status")))])]),e("div",{staticClass:"set-status-modal__online-status",attrs:{role:"radiogroup","aria-label":t.$t("user_status","Online status")}},t._l(t.statuses,function(s){return e("OnlineStatusSelect",t._b({key:s.type,attrs:{checked:s.type===t.statusType},on:{select:t.changeStatus}},"OnlineStatusSelect",s,!1))}),1),e("form",{on:{submit:function(s){return s.preventDefault(),t.saveStatus.apply(null,arguments)},reset:t.clearStatus}},[e("div",{staticClass:"set-status-modal__header"},[e("h2",[t._v(t._s(t.$t("user_status","Status message")))])]),e("div",{staticClass:"set-status-modal__custom-input"},[e("CustomMessageInput",{ref:"customMessageInput",attrs:{icon:t.icon,message:t.editedMessage},on:{change:t.setMessage,"select-icon":t.setIcon}})],1),t.hasBackupStatus?e("div",{staticClass:"set-status-modal__automation-hint"},[t._v(" "+t._s(t.$t("user_status","Your status was set automatically"))+" ")]):t._e(),t.hasBackupStatus?e("PreviousStatus",{attrs:{icon:t.backupIcon,message:t.backupMessage},on:{select:t.revertBackupFromServer}}):t._e(),e("PredefinedStatusesList",{on:{"select-status":t.selectPredefinedMessage}}),e("ClearAtSelect",{attrs:{"clear-at":t.clearAt},on:{"select-clear-at":t.setClearAt}}),e("div",{staticClass:"status-buttons"},[e("NcButton",{attrs:{wide:!0,type:"tertiary","native-type":"reset","aria-label":t.$t("user_status","Clear status message"),disabled:t.isSavingStatus}},[t._v(" "+t._s(t.$t("user_status","Clear status message"))+" ")]),e("NcButton",{attrs:{wide:!0,type:"primary","native-type":"submit","aria-label":t.$t("user_status","Set status message"),disabled:t.isSavingStatus}},[t._v(" "+t._s(t.$t("user_status","Set status message"))+" ")])],1)],1)])])},V=[],Z=i(K,Q,V,!1,null,"102051a3",null,null);const mt=Z.exports;export{mt as default};
